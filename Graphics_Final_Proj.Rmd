---
title: "Graphics Project"
output: html_notebook
---

```{r}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message =  FALSE)
library(ggplot2)
library(GGally)
library(dplyr)
library(tidyr)
library(mi)
library(forcats)
require(gdata)
library(rvest)
library(vcd)
```

##I. Introduction

##II. Description of the data source

We both collected data in terms of different variables. Data are all from "Centers for Disease Control and Prevention" in the form of downloading excels (or csv) or scraping data from the web pages. Factors causing diabetes are grouped by several categories including body indicators, age, education, sweet beverage consumption, alcohol, and per capita GDP. Records are based on 55 states of US. 

Regarding sweet beverage consumption among adults, we only obtained data from 24 states.


####https://gis.cdc.gov/grasp/diabetes/DiabetesAtlas.html

##III. Description of data import / cleaning / transformation

####Read in Raw Data
```{r}
Sn <- read.csv("data(raw)/Sn.csv",skip = 2, na.strings = "No Data")
Sp <- read.csv("data(raw)/Sp.csv",skip = 2, na.strings = "No Data")
On <- read.csv("data(raw)/On.csv",skip = 2, na.strings = "No Data")
Op <- read.csv("data(raw)/Op.csv",skip = 2, na.strings = "No Data")
PGn <- read.csv("data(raw)/PGn.csv",skip = 2, na.strings = "No Data")
PGp <- read.csv("data(raw)/PGp.csv",skip = 2, na.strings = "No Data")
Dn <- read.csv("data(raw)/Dn.csv",skip = 2, na.strings = "No Data")
Dp <- read.csv("data(raw)/Dp.csv",skip = 2, na.strings = "No Data")
Phn <- read.csv("data(raw)/Phn.csv",skip = 2, na.strings = "No Data")
Php <- read.csv("data(raw)/Php.csv",skip = 2, na.strings = "No Data")
Hypern <- read.csv("data(raw)/Hypern.csv",skip = 2, na.strings = "No Data")
Hyperp <- read.csv("data(raw)/Hyperp.csv",skip = 2, na.strings = "No Data")
HCn <- read.csv("data(raw)/HCn.csv",skip = 2, na.strings = "No Data")
HCp <- read.csv("data(raw)/HCp.csv",skip = 2, na.strings = "No Data")
alcohol <- read.csv("data(raw)/alcohol.csv")
sugar1 <- read.csv("data(raw)/sugar2.csv")
sugar2 <- read.csv("data(raw)/sugar3.csv")
sugar3 <- read.csv("data(raw)/sugar1.csv")
underH <- read.csv("data(raw)/<H.csv",skip = 2, na.strings = "No Data")
H <- read.csv("data(raw)/H.csv",skip = 2, na.strings = "No Data")
postH <- read.csv("data(raw)/>H.csv",skip = 2, na.strings = "No Data")
age1 <- read.csv("data(raw)/18-44.csv",skip = 2, na.strings = "No Data")
age2 <- read.csv("data(raw)/45-64.csv",skip = 2, na.strings = "No Data")
age3 <- read.csv("data(raw)/65-74.csv",skip = 2, na.strings = "No Data")
age4 <- read.csv("data(raw)/75+.csv",skip = 2, na.strings = "No Data")
GDP2015 <- read.csv("data(raw)/2015.csv",skip = 4)
GDP2016 <- read.csv("data(raw)/2016.csv", skip = 4)
mcdonald <- read.xls("data(raw)/mcdonald.xlsx")
```

####Basic Data Cleaning

```{r}
clean <- function(df1,df2){
  df1 <- df1[-nrow(df1),]
  df2 <- df2[-nrow(df2),]
  overall <- full_join(df1,df2, by="State")
  return(overall)
}
clean2 <- function(df1){
  df1 <- df1[-nrow(df1),] %>% select(1:2)
  return(df1)
}
```

```{r}
Smoking <- clean(Sn,Sp)
Smoking$Type <- rep("Smoking",nrow(Smoking))
Smoking

Obesity <- clean(Op, On)
Obesity$Type <- rep("Obesity",nrow(Obesity))

Poor_Health <- clean(PGn, PGp)
Poor_Health$Type <- rep("Poor_Health",nrow(Poor_Health))

Num <- clean(Dn,Dp)
Num$Type <- rep("Num",nrow(Num))

Inactivity <- clean(Phn,Php)
Inactivity$Type <- rep("Inactivity",nrow(Inactivity))

Hypertension <- clean(Hyperp,Hypern)
Hypertension$Type <- rep("Hypertension",nrow(Hypertension))

Cholesterol <- clean(HCn, HCp)
Cholesterol$Type <- rep("HighCholesterol",nrow(Cholesterol))

alcohol <- alcohol %>% 
  select(2:5) %>% 
  mutate(Num.Drink = Total.Cost.../Cost.Per.Drink...)
names(alcohol)[1] <- "State"

names(sugar1) <- c("State","No.","18-24","25-34","35-54",">55","Male","Female","White","Black","Hispanic","Other")
names(sugar2) <- c("State","No.","Employed","Unemployed","Retired","<HighSchool","HighSchool","College","College.Grad")
names(sugar3) <- c("State","ResNumber","None","Ls1perDay","Gr1perDay")
sugar3

SweetBev <- full_join(sugar1,sugar2,by="State")
SweetBev <- SweetBev[!duplicated(as.list(SweetBev))]
names(SweetBev)[2] <- "ResNumber"

underH <- clean2(underH)
names(underH) <- c("State","UnderHighSchool")
H <- clean2(H)
names(H) <- c("State","HighSchool")
postH <- clean2(postH)
names(postH) <- c("State","HighSchool+")
education <- full_join(full_join(underH,H,by="State"),postH,by="State")


age1 <- clean2(age1)
age2 <- clean2(age2)
age3 <- clean2(age3)
age4 <- clean2(age4)
names(age1) <- c("State","18-44")
names(age2) <- c("State","45-64")
names(age3) <- c("State","65-74")
names(age4) <- c("State","75+")
Age <- full_join(full_join(full_join(age1,age2,by="State"),age3, by="State"),age4,by="State")

GDP2015 <- GDP2015[1:(nrow(GDP2015)-3),]
GDP2016 <- GDP2016[1:(nrow(GDP2016)-3),]

Indicators <- rbind(Smoking,Obesity,Poor_Health,Num, Inactivity,Hypertension, Cholesterol)
Indicators$Type <- as.factor(Indicators$Type)
mcdonald <- mcdonald %>% select(State, Rank, No..of.Mcdonald.s.locations)
names(mcdonald) <- c("State","Rank","McNumber")
mcdonald
```


```{r}
ms <- Indicators %>% select(1,3,6) %>% spread(Type, Percentage)
ms1 <- full_join(full_join(full_join(ms,Age,by="State"),education,by="State"),sugar3%>%select(1,3,4,5),by="State")
ms1 #dataframe of all indicators with percentage values

Indicators

Age

education

sugar3

ms2 <- full_join(mcdonald,alcohol%>%select(1,5),by="State")
ms2 #dataframe of indicators with exact number (mc+alcohol)

mcdonald

alcohol

GDP2015

GDP2016
```


##IV. Analysis of missing values

```{r}
#heatmap(1 * is.na(ms1), Rowv = NA, Colv = NA)
#ms1
image(missing_data.frame(ms1))
#extracat::visna(ms1)
image(missing_data.frame(ms2))
ms1
```

**Dealing with missing values**

###Minor Risk Factors

**Dot Plots(Facet-wrap)**
```{r}
df_num <- gather(df_percent,key = "Type", value = "Percent", colnames(df_percent%>%select(2:4,6:8)))
#df_num
```


```{r}
ggplot(df_num%>%filter(State != "Puerto Rico"),aes(x=Num, y=Percent))+geom_point() + facet_wrap(~ Type)+ggtitle("Diagnosed Diabetes vs. Potential Risk Factors") + xlab("Diagnosed Diabetes")
```

**Parallel Coordinates Plot**
```{r}
df_percent <- na.omit(ms1[,1:8][order(ms1$Num,decreasing = T),])
df_percent <- df_percent %>% 
  filter(State != "Median of States") %>% 
  mutate(Rank = c(1:51))
#df_percent
```

```{r}
df_all <- gather(df_percent,key = "RiskFactor", value = "Percent", colnames(df_percent%>%select(2:8)))
#df_all
temp <- df_all %>% group_by(RiskFactor) %>%
  mutate(Percent = scales::rescale(Percent)) %>% ungroup()
g1 <- ggplot(temp%>%filter(State != "Puerto Rico"), aes(x = reorder(State,Rank), y = Percent,group=RiskFactor,col=RiskFactor)) + 
  geom_line(alpha = .5) + ggtitle("Diagnosed Diabetes and Risk Factors")
g1+theme(axis.text.x = element_text(angle = 90))+xlab("Risk Factor")
```




```{r}
Age <- na.omit(Age[-1,])
full_join(Age, Num)%>%select(1:5,7)
df_age <- gather(Age, key = "Age", value = "Percent", colnames(Age%>%select(2:5)))
df_age
ggparcoord(df_age, columns = 3, groupColumn = 2)
```


##V. Results
```{r}

```

##VI. Interactive component
```{r}

```


##VII. Conclusion
```{r}

```

